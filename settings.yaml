# TenderAI BF Configuration File
# Production-grade settings for multi-agent RFP harvester

# Application Settings
app_name: "TenderAI BF"
app_version: "1.0.0" 
environment: "production"  # Options: development, staging, production
debug: false
log_level: "INFO"

# Database Configuration
database:
  url: "${TENDERAI_DATABASE_URL}"  # PostgreSQL connection string
  pool_size: 10
  max_overflow: 20
  pool_timeout: 30
  pool_recycle: 3600

# Email Configuration
email:
  smtp_server: "${TENDERAI_SMTP_SERVER}"
  smtp_port: 587
  smtp_use_tls: true
  smtp_username: "${TENDERAI_SMTP_USERNAME}"
  smtp_password: "${TENDERAI_SMTP_PASSWORD}"
  from_address: "${TENDERAI_FROM_EMAIL}"
  to_address: "${TENDERAI_TO_EMAIL}"
  reply_to: "${TENDERAI_FROM_EMAIL}"
  
  # Email templates (French)
  subject_template: "üîç TenderAI - Rapport d'appels d'offres {date}"
  body_template: |
    Bonjour,
    
    Veuillez trouver ci-joint le rapport des appels d'offres pour la date du {date}.
    
    R√©sum√© :
    - {total_items} appels d'offres trouv√©s
    - {relevant_items} pertinents pour l'IT/Ing√©nierie
    - {urgent_items} avec √©ch√©ances urgentes
    
    Cordialement,
    TenderAI BF

# Storage Configuration (MinIO/S3)
storage:
  endpoint_url: "${TENDERAI_STORAGE_ENDPOINT}"
  access_key: "${TENDERAI_STORAGE_ACCESS_KEY}"
  secret_key: "${TENDERAI_STORAGE_SECRET_KEY}"
  bucket_name: "${TENDERAI_STORAGE_BUCKET}"
  region: "us-east-1"
  use_ssl: true
  create_bucket: true

# Pipeline Configuration
pipeline:
  max_items_per_source: 100
  max_total_items: 500
  timeout_seconds: 3600  # 1 hour
  retry_attempts: 3
  retry_delay: 5
  
  # Rate limiting
  default_rate_limit: "10/m"  # 10 requests per minute
  respect_robots_txt: false
  user_agent: "TenderAI-BF/1.0 (+https://github.com/your-org/tenderai-bf)"

# Scheduler Configuration
scheduler:
  enabled: true
  timezone: "Africa/Ouagadougou"
  cron_schedule: "30 7 * * 1-5"  # 7:30 AM, Monday to Friday
  max_concurrent_runs: 1
  catch_up: false

# LangChain/LangGraph Configuration
langchain:
  # Default LLM settings (update with your provider)
  llm_provider: "openai"  # Options: openai, anthropic, azure_openai, groq, ollama
  model_name: "gpt-4o-mini"
  temperature: 0.1
  max_tokens: 1000
  api_key: "${LANGCHAIN_API_KEY}"
  
  # Ollama settings (for local LLM deployment)
  ollama_base_url: "${OLLAMA_BASE_URL:-http://host.docker.internal:11434}"  # Ollama server endpoint
  ollama_model: "${OLLAMA_MODEL:-llama3.1}"  # Model name in Ollama (e.g., llama3.1, mistral, mixtral)
  
  # For Azure OpenAI (uncomment if using)
  # azure_endpoint: "${AZURE_OPENAI_ENDPOINT}"
  # azure_deployment: "${AZURE_OPENAI_DEPLOYMENT}"
  # api_version: "2024-02-01"

# Sources Configuration
sources:

  - name: "DGCMEF - Direction G√©n√©rale du Contr√¥le des March√©s Publics"
    list_url: "https://www.dgcmef.gov.bf/fr/appels-d-offre"
    parser: "pdf_quotidien"  # Special parser for daily bulletin PDFs
    rate_limit: "5/m"
    enabled: false
    description: "Quotidiens des march√©s publics (PDF bulletins)"
    # Specific settings for DGCMEF
    quotidien_settings:
      fetch_latest_only: true  # Only fetch the most recent bulletin
      table_selector: "table"  # CSS selector for the quotidien table
      title_column: 0  # First column contains the title
      pdf_column: 1    # Second column contains the PDF link

  - name: "DGCMEF RAG - PDF Quotidien avec RAG"
    list_url: "https://www.dgcmef.gov.bf/fr/appels-d-offre"
    parser: "pdf_rag"  # RAG-based parser for PDF extraction using Chroma + LLM
    rate_limit: "5/m"
    enabled: true
    description: "Quotidiens des march√©s publics parsed with RAG system"
    # RAG-specific settings
    rag_settings:
      use_llm: true  # Use LLM for tender extraction
      chunk_size: 512
      top_k_results: 5
    quotidien_settings:
      fetch_latest_only: true
      table_selector: "table"
      title_column: 0
      pdf_column: 1

  - name: "Joffres.net - Appels d'Offres Publics"
    list_url: "https://www.joffres.net/appel-offres-publics"
    item_url_pattern: "https://www.joffres.net/appeloffre/{slug}"
    parser: "html-listing"  # HTML listing pages with detail links
    rate_limit: "10/m"
    enabled: false
    description: "Plateforme collaborative d'appels d'offres publics"
    joffres_settings:
      item_selector: ".tender-item, .appel-offre, [data-tender]"
      slug_attribute: "data-slug"
      title_selector: ".tender-title, h3"
      entity_selector: ".entity-name, .company"
      deadline_selector: ".deadline, .date-limite"

  - name: "Joffres.net - Appels d'Offres Priv√©s"
    list_url: "https://www.joffres.net/appel-offres-priv%C3%A9s"
    item_url_pattern: "https://www.joffres.net/appeloffre/{slug}"
    parser: "html-listing"  # HTML listing pages with detail links
    rate_limit: "10/m"
    enabled: false
    description: "Plateforme collaborative d'appels d'offres priv√©s"
    joffres_settings:
      item_selector: ".tender-item, .appel-offre, [data-tender]"
      slug_attribute: "data-slug"
      title_selector: ".tender-title, h3"
      entity_selector: ".entity-name, .company"
      deadline_selector: ".deadline, .date-limite"

# Classification Settings
classification:
  relevant_keywords:
    it_services:
      - "informatique"
      - "logiciel"
      - "d√©veloppement"
      - "application"
      - "syst√®me d'information"
      - "base de donn√©es"
      - "r√©seau"
      - "cybers√©curit√©"
      - "cloud"
      - "num√©rique"
      - "digital"
      - "site web"
      - "plateforme"
      - "e-gouvernement"
      - "gestion √©lectronique"
      
    engineering:
      - "ing√©nierie"
      - "g√©nie civil"
      - "infrastructure"
      - "construction"
      - "BTP"
      - "routes"
      - "b√¢timent"
      - "√©lectricit√©"
      - "t√©l√©communications"
      - "√©nergie"
      - "hydraulique"
      - "assainissement"
      
    consulting:
      - "conseil"
      - "consultance"
      - "√©tude"
      - "expertise"
      - "assistance technique"
      - "formation"
      - "audit"
      - "√©valuation"
      
    it_hardware:
      - "√©quipement informatique"
      - "mat√©riel informatique"
      - "ordinateur"
      - "serveur"
      - "poste de travail"
      - "mat√©riel de bureau"
      - "imprimante"
      - "scanner"
      - "photocopieur"
      - "disque dur"
      - "m√©moire RAM"
      - "processeur"
      - "carte graphique"
      - "carte m√®re"
      - "alimentation √©lectrique"
      - "onduleur"
      - "batterie"
      - "c√¢bles"
      - "connecteurs"
      - "accessoires informatiques"
      - "√©cran"
      - "moniteur"
      - "clavier"
      - "souris"
      - "hub USB"
      - "adaptateur"
      - "routeur"
      - "switch r√©seau"
      - "modem"
      - "point d'acc√®s wifi"
      - "disque SSD"
      - "lecteur optique"
      - "webcam"
      - "microphone"
      - "enceinte"
      - "casque audio"

# RAG (Retrieval-Augmented Generation) Settings
rag:
  enabled: true
  vector_db: "chroma"  # Vector database backend
  embedding_model: "intfloat/multilingual-e5-large-instruct"  # Sentence-transformers model for embeddings
  chunk_size: 76800  # Size of text chunks for indexing (increased to reduce number of chunks and API calls)
  chunk_overlap: 2400  # Overlap between chunks for context preservation
  top_k_results: 10  # Number of similar chunks to retrieve
  
  # Chroma specific settings
  chroma:
    persist_directory: "./data/chroma_db"  # Directory to persist vector database
    collection_prefix: "tenders"  # Prefix for collection names
    host: null  # Leave null for embedded mode, or set hostname for server mode
    port: null  # Leave null for embedded mode
    
    # Metadata to track with each chunk
    track_metadata:
      - source
      - date
      - filename
      - page_number
      - tender_id
    
    # Query for vector similarity search (used to find relevant documents)
    # This should be in the same language as the documents and capture what we're looking for
    vector_search_query: "Extraire les appels d'offres publics, entit√©s, dates limites, et pertinence IT/Ing√©nierie"

# Prompts Configuration (French language for better results with French documents)
prompts:
  extraction:
    system: |
      Vous √™tes un expert des march√©s publics charg√© d‚Äôextraire, √† partir d‚Äôun extrait de document (chunk), les informations relatives :
      - aux NOUVEAUX appels d‚Äôoffres ;
      - aux AVIS li√©s √† des appels d‚Äôoffres existants (communiqu√©s, rectificatifs, prorogations, annulations, etc.).

      Le texte fourni peut √™tre incomplet : vous ne voyez qu‚Äôune partie du document.
      Par cons√©quent :
      - Vous ne devez JAMAIS inventer d‚Äôinformations qui ne sont pas clairement pr√©sentes dans le texte.
      - Vous ne devez cr√©er un √©l√©ment que si le texte d√©crit clairement un appel d‚Äôoffres ou un avis li√© √† un appel d‚Äôoffres.
      - Si une information attendue n‚Äôest pas pr√©sente dans le texte, vous laissez le champ vide / null lorsque le sch√©ma le permet, ou utilisez une valeur g√©n√©rique neutre comme "Inconnu" plut√¥t que d‚Äôinventer.
      - Si l‚Äôextrait ne contient aucun appel d‚Äôoffres ni avis li√©, clairement identifiable, la liste `tenders` doit √™tre vide.

      Types d‚Äô√©l√©ments √† extraire (champ `type`) :
      - "appel_offres"   : nouveau lancement d‚Äôappel d‚Äôoffres ;
      - "rectificatif"   : avis rectifiant ou corrigeant un appel d‚Äôoffres existant ;
      - "prorogation"    : avis prolongeant la date limite de soumission ;
      - "communique"     : communiqu√© officiel apportant des pr√©cisions ou informations compl√©mentaires sur un appel d‚Äôoffres ;
      - "annulation"     : avis d‚Äôannulation d‚Äôun appel d‚Äôoffres ;
      - "autre"          : tout autre avis li√© aux march√©s publics ne rentrant pas clairement dans les cat√©gories pr√©c√©dentes.

      Vous devez IGNORER absolument les avis d‚Äôattribution / r√©sultats,

      Pour chaque √©l√©ment (appel d‚Äôoffres ou avis) que vous extrayez, vous devez remplir les champs du sch√©ma de sortie comme suit :

      - type :
          * Utiliser STRICTEMENT l‚Äôune des valeurs suivantes : "appel_offres", "rectificatif", "prorogation", "communique", "annulation", "autre".
          * Si le texte d√©crit un nouveau lancement d‚Äôappel d‚Äôoffres, utiliser "appel_offres".
          * Si le texte d√©crit une modification, une correction ou une pr√©cision, choisir le type le plus appropri√© ("rectificatif", "prorogation", "communique", "annulation", ou "autre").

      - entity :
          * Entit√© ou organisme √©metteur de l‚Äôappel d‚Äôoffres ou de l‚Äôavis.
          * Utiliser le libell√© exact du texte lorsque possible.
          * Si l‚Äôentit√© est totalement absente du texte et ne peut pas √™tre d√©duite, utiliser "Inconnu" plut√¥t que d‚Äôinventer un nom pr√©cis.

      - reference :
          * Num√©ro de r√©f√©rence ou identifiant de l‚Äôappel d‚Äôoffres, si pr√©sent.
          * Exemple : "N¬∞2025-0095-/MEF/SG/DMP".
          * Si aucun identifiant n‚Äôest clairementment mentionn√©, utiliser "Inconnu" plut√¥t que d‚Äôen inventer un.

      - tender_object :
          * Reprendre l‚Äôobjet de l‚Äôappel d‚Äôoffres ou de l‚Äôavis tel qu‚Äôil appara√Æt dans le document.
          * Il s‚Äôagit g√©n√©ralement du titre ou de la ligne/phrase qui r√©sume imm√©diatement l‚Äôobjet principal (par exemple : "Acquisition de fournitures de bureau et de produits d'entretien au profit de la DCIM.").
          * Ne JAMAIS r√©sumer ni reformuler ce champ : le texte doit √™tre copi√© aussi fid√®lement que possible depuis le document (hors artefacts de mise en page).

      - deadline :
          * Date limite de d√©p√¥t des offres, lorsque l‚Äô√©l√©ment concerne un appel d‚Äôoffres ou une prorogation.
          * Normaliser si possible au format "DD-MM-YYYY".
          * Si la date est absente ou ambigu√´ dans l‚Äôextrait, laisser ce champ vide / null.

      - description :
          * Fournir une description d√©taill√©e de l‚Äôappel d‚Äôoffres ou de l‚Äôavis, bas√©e STRICTEMENT sur le texte de l'appel ou de l'avis.
          * Cette description doit faore ressortir les informations importantes : nature des travaux ou prestations, principaux lieux d‚Äôex√©cution, lots √©ventuels, √©l√©ments essentiels des conditions de participation, etc.
          * Si le texte source est tr√®s long (plusieurs paragraphes), vous POUVEZ produire une version r√©sum√©e, √† condition de rester fid√®le aux informations pr√©sentes.
          * Ne pas inventer de nouvelles informations ; ne r√©sumer que ce qui est r√©ellement pr√©sent dans le texte.

      - category :
          * Cat√©gorie de l‚Äôappel d‚Äôoffres, en utilisant des valeurs homog√®nes (par exemple "IT", "Ing√©nierie", "Services", "Biens", "Travaux", "Autre").
          * Choisir la valeur la plus coh√©rente avec la nature de l‚Äôobjet (informatique / ing√©nierie / services / biens / autre).
          * Si vous h√©sitez fortement, utiliser "Autre" plut√¥t que de forcer une cat√©gorie inappropri√©e.

      - keywords :
          * Liste de 3 √† 10 mots ou expressions cl√©s r√©ellement pertinents et directement li√©s au texte.
          * Exemple : ["fourniture de mat√©riel informatique", "serveurs", "installation", "maintenance"].
          * Ne pas ajouter de mots-cl√©s qui ne sont pas support√©s par le texte.

      - relevance_score :
          * Score de pertinence entre 0.0 et 1.0 indiquant √† quel point le texte d√©crit clairement un appel d‚Äôoffres ou un avis li√© √† un appel d‚Äôoffres.
          * 1.0 : informations tr√®s claires, structure d‚Äôavis / appel d‚Äôoffres explicite.
          * ‚âà0.5 : informations partielles mais manifestement en lien avec un appel d‚Äôoffres.
          * 0.0 : ne pas cr√©er d‚Äô√©l√©ment dans `tenders` dans ce cas.

      - budget :
          * Indiquer uniquement si un montant ou un budget est explicitement mentionn√© dans le texte.
          * Exemple : "250 000 000 FCFA".
          * Sinon, laisser ce champ vide / null.

      - location :
          * Localisation g√©ographique (ville, r√©gion, pays) si elle est clairement identifiable dans le texte.
          * Sinon, laisser ce champ vide / null.

      - source_url :
          * URL ou r√©f√©rence de la source si elle appara√Æt explicitement dans le texte.
          * Sinon, laisser ce champ vide / null.

      Champs globaux du conteneur :
      - total_extracted :
          * Nombre total d‚Äô√©l√©ments (appels d‚Äôoffres et avis) extraits √† partir de l‚Äôextrait fourni.
          * Doit √™tre √©gal √† la longueur de la liste `tenders`.

      - confidence :
          * Niveau global de confiance, entre 0.0 et 1.0, refl√©tant la fiabilit√© de l‚Äôextraction pour cet extrait.
          * Plus les entit√©s, r√©f√©rences, deadlines et descriptions sont claires et coh√©rentes, plus la confiance doit √™tre √©lev√©e.
          * Ne pas mettre syst√©matiquement 1.0 ; adapter en fonction de la qualit√© r√©elle des informations.

      R√àGLES IMPORTANTES :
      - Vous ne devez jamais inventer de noms d‚Äôentit√©s, de r√©f√©rences ou de montants plausibles.
      - Vous devez vous contenter de ce qui est explicitement pr√©sent ou raisonnablement d√©ductible sans extrapolation.
      - Vous ne devez pas ajouter de texte explicatif en dehors des champs du sch√©ma de sortie.
      - Si le texte est trop fragmentaire pour caract√©riser clairement un appel d‚Äôoffres ou un avis, n‚Äôextrayez rien pour cet √©l√©ment.

    user_template: |
      Analysez l‚Äôextrait suivant et extrayez tous les nouveaux appels d‚Äôoffres et tous les avis (communiqu√©s, rectificatifs, prorogations, annulations, etc.) qui y sont li√©s :
      
      {context}

  # Classification prompt - Used to determine if a tender is relevant
  classification:
    system: |
      Vous √™tes un expert en march√©s publics sp√©cialis√© dans l'identification des appels d'offres pertinents pour les secteurs de l'informatique, l'ing√©nierie, les r√©seaux et syst√®mes informatiques, t√©l√©communications, big data, intelligence artificielle et fourniture de mat√©riels informatiques et consommables bureautiques.
      
      Votre mission est d'analyser chaque appel d'offres et de d√©terminer sa pertinence selon les crit√®res suivants :
      
      PERTINENT SI :
      - Concerne les technologies de l'information (logiciels, syst√®mes, digitalisation, e-services, r√©seaux, cybers√©curit√©, cloud, intelligence artificielle, big data, etc.)
      - Concerne l'ing√©nierie (t√©l√©communications, etc.)
      - Inclut des services de conseil ou d'assistance technique dans ces domaines
      - Fourniture d'√©quipements informatiques et consommables bureautiques ou techniques
      
      NON PERTINENT SI :
      - Services de nettoyage ou d'entretien g√©n√©ral
      - Fournitures alimentaires ou m√©dicales
      - V√©hicules ou transport (sauf si li√© √† l'Informatique/Ing√©nierie)
      
      Pour chaque appel d'offres, fournissez :
      - is_relevant : true ou false
      - confidence : Niveau de confiance de 0.0 √† 1.0
      - reasoning : Br√®ve explication de votre d√©cision
      - suggested_category : "Informatique", "Ing√©nierie", "Mat√©riels informatiques", ou "Autre"
    
    user_template: |
      Analysez la pertinence de cet appel d'offres :
      
      Entit√© : {entity}
      R√©f√©rence : {reference}
      Objet : {objet}
      Description : {description}
      Mots-cl√©s : {keywords}
      
      Est-ce pertinent pour les secteurs "Informatique", "Ing√©nierie", "Mat√©riels informatiques" ?
  
  # Summarization prompt - Used to create summaries for reports
  summarization:
    system: |
      Vous √™tes un r√©dacteur sp√©cialis√© dans la synth√®se d'informations sur les march√©s publics.
      
      Cr√©ez des r√©sum√©s clairs, concis et informatifs qui permettent aux d√©cideurs de comprendre rapidement :
      - L'objet de l'appel d'offres
      - Les exigences principales
      - Les d√©lais importants
      - Les opportunit√©s potentielles
      
      R√©digez en fran√ßais professionnel, en utilisant des phrases courtes et pr√©cises.
    
    user_template: |
      Cr√©ez un r√©sum√© concis (2-3 phrases) pour cet appel d'offres :
      
      {tender_details}
  
  # Deduplication prompt - Used to identify duplicate tenders
  deduplication:
    system: |
      Vous √™tes un expert en identification des doublons dans les appels d'offres.
      
      Comparez les appels d'offres et d√©terminez s'ils sont identiques, m√™me si :
      - La formulation diff√®re l√©g√®rement
      - Les dates de publication varient
      - Les sources sont diff√©rentes
      
      Deux appels d'offres sont des DOUBLONS si :
      - M√™me entit√© √©mettrice
      - M√™me r√©f√©rence ou num√©ro
      - M√™me objet/description principale
      - M√™me date limite
      
      Ils sont DIFF√âRENTS si :
      - Objets distincts m√™me si entit√© identique
      - R√©f√©rences diff√©rentes
      - Dates limites diff√©rentes (√©cart > 2 jours)
    
    user_template: |
      Comparez ces deux appels d'offres et d√©terminez s'il s'agit d'un doublon :
      
      APPEL D'OFFRES 1 :
      {tender1}
      
      APPEL D'OFFRES 2 :
      {tender2}
      
      R√©pondez avec : is_duplicate (true/false), confidence (0.0-1.0), reasoning (explication)

# Processing Settings (includes relevance threshold)
processing:
  min_relevance_score: ${MIN_RELEVANCE_SCORE:-0.7}  # Threshold for RAG results (0.0 = all items, 1.0 = only perfect matches)
  use_llm_classification: true  # If true, use LLM for classification; if false, use keyword matching

# Report Configuration
report:
  template_path: "templates/report_template.docx"
  include_screenshots: false
  include_source_urls: true
  max_items_in_summary: 20
  
  # Report sections
  sections:
    - title: "R√©sum√© Ex√©cutif"
      type: "executive_summary"
    - title: "Appels d'Offres IT"
      type: "filtered_notices"
      filter: "it_services"
    - title: "Appels d'Offres Ing√©nierie"
      type: "filtered_notices"
      filter: "engineering"
    - title: "Autres Opportunit√©s"
      type: "filtered_notices" 
      filter: "other"
    - title: "Annexes"
      type: "appendices"

# Recipients Configuration
recipients:
  - name: "√âquipe Direction"
    email: "oconstantin@yulcom-technologies.com"
    type: "secondary"

        
  # Add additional recipients as needed
  # - name: "√âquipe Commercial"
  #   email: "commercial@yourcompany.com"
  #   type: "secondary"

# Logging Configuration
logging:
  version: 1
  disable_existing_loggers: false
  
  formatters:
    json:
      format: '{"timestamp": "%(asctime)s", "level": "%(levelname)s", "logger": "%(name)s", "message": "%(message)s"}'
    simple:
      format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
      
  handlers:
    console:
      class: logging.StreamHandler
      level: INFO
      formatter: simple
      stream: ext://sys.stdout
      
    file:
      class: logging.handlers.RotatingFileHandler
      level: DEBUG
      formatter: json
      filename: logs/tenderai.log
      maxBytes: 10485760  # 10MB
      backupCount: 5
      
  loggers:
    tenderai_bf:
      level: DEBUG
      handlers: [console, file]
      propagate: false
      
    httpx:
      level: WARNING
      handlers: [console]
      
    urllib3:
      level: WARNING
      handlers: [console]
      
  root:
    level: INFO
    handlers: [console]

# Monitoring and Metrics
monitoring:
  enable_metrics: true
  metrics_port: 8000
  health_check_endpoint: "/health"
  
  # Prometheus metrics (if using)
  prometheus:
    enabled: false
    port: 9090
    path: "/metrics"

# Security Settings
security:
  # JWT Authentication
  jwt_secret_key: "${TENDERAI_JWT_SECRET:-change-this-secret-key-in-production-use-openssl-rand-hex-32}"
  jwt_algorithm: "HS256"
  jwt_access_token_expire_minutes: 1440  # 24 hours
  
  # Admin credentials (for initial setup - move to database later)
  admin_username: "${TENDERAI_ADMIN_USERNAME:-admin}"
  admin_password: "${TENDERAI_ADMIN_PASSWORD:-admin123}"  # CHANGE IN PRODUCTION!
  
  # Security limits
  max_file_size_mb: 100
  allowed_file_types: [".pdf", ".doc", ".docx", ".html", ".txt"]
  max_request_timeout: 60
  
  # User agent rotation (optional)
  rotate_user_agents: false
  user_agents:
    - "TenderAI-BF/1.0"
    - "Mozilla/5.0 (compatible; TenderAI-BF/1.0)"

# Development/Testing Settings
development:
  mock_external_apis: false
  save_debug_files: false
  debug_output_dir: "debug/"
  
  # Test data
  use_test_sources: false
  test_sources:
    - name: "Test Source"
      list_url: "https://www.arcop.bf/appels-doffres/"
      parser: "pdf"
      rate_limit: "1/s"